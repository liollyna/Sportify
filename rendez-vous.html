<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Votre Compte - Sportify</title>
    <link rel="stylesheet" href="rendez-vous.css">
    <script defer src="rendez-vous.js"></script>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="index.html">Accueil</a></li>
                <li><a href="tout-parcourir.html">Tout Parcourir</a></li>
                <li><a href="recherche.html">Recherche</a></li>
                <li><a href="rendez-vous.html">Rendez-vous</a></li>
                <li><a href="votre-compte.html">Votre Compte</a></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <section>
            <h1>Votre Compte</h1>
            <p>Gérez votre compte Sportify et accédez à vos informations personnelles.</p>
            
            <h2>Informations Personnelles</h2>
            <ul>
                <li>Nom : John Doe</li>
                <li>Email : johndoe@example.com</li>
                <li>Adresse : 123 Rue Sport, Ville Sportive</li>
                <li>Téléphone : 123-456-7890</li>
            </ul>
            
            <h2>Votre Emploi du Temps</h2>
            <ul>
                <li>Lundi - 10h-12h : Séance de Natation</li>
                <li>Mardi - 15h-17h : Entraînement de Rugby</li>
                <li>Mercredi - 9h-11h : Cours de Fitness</li>
                <!-- Ajoutez d'autres créneaux horaires et activités -->
            </ul>
            
            <h2>Prendre un Rendez-vous</h2>
            <form action="" method="post">
                <label for="date">Date :</label>
                <input type="date" id="date" name="date" required>
                
                <label for="heure">Heure :</label>
                <input type="time" id="heure" name="heure" required>
                
                <label for="activite">Activité :</label>
                <select id="activite" name="activite" required>
                    <option value="1">Séance de Natation</option>
                    <option value="2">Entraînement de Rugby</option>
                    <option value="3">Cours de Fitness</option>
                    <!-- Ajoutez d'autres activités disponibles -->
                </select>
                
                <button type="submit" name="action" value="book">Prendre un Rendez-vous</button>
            </form>

            <hr>
            
            <?php
            // Informations de connexion à la base de données
            $database = "spotify2";
            $db_handle = mysqli_connect('localhost', 'root', '', $database);

            // Vérifier la connexion
            if (!$db_handle) {
                die("Échec de la connexion : " . mysqli_connect_error());
            }

            if ($_SERVER["REQUEST_METHOD"] == "POST") {
                $action = $_POST['action'];

                switch ($action) {
                    case 'book':
                        $date = $_POST['date'];
                        $heure = $_POST['heure'];
                        $activite_id = $_POST['activite'];
                        $utilisateur_id = 1; // Supposons que l'utilisateur est connecté et son id est 1

                        // Vérifier la disponibilité des coachs pour le créneau choisi
                        $sql_dispos = "SELECT coachs.id AS coach_id, coachs.nom AS coach, disponibilites.date, disponibilites.heure_debut, disponibilites.heure_fin, activites.nom AS activite
                                       FROM coachs
                                       JOIN disponibilites ON coachs.id = disponibilites.coach_id
                                       JOIN activites ON activites.id = $activite_id
                                       WHERE disponibilites.date = '$date'
                                       AND disponibilites.heure_debut <= '$heure'
                                       AND disponibilites.heure_fin > '$heure'";

                        $result_dispos = mysqli_query($db_handle, $sql_dispos);

                        if (mysqli_num_rows($result_dispos) > 0) {
                            echo "<h2>Disponibilités</h2>";
                            echo "<table>
                                    <tr>
                                        <th>Date</th>
                                        <th>Heure Début</th>
                                        <th>Heure Fin</th>
                                        <th>Activité</th>
                                        <th>Coach</th>
                                    </tr>";
                            while ($row = mysqli_fetch_assoc($result_dispos)) {
                                echo "<tr>
                                        <td>" . $row['date'] . "</td>
                                        <td>" . $row['heure_debut'] . "</td>
                                        <td>" . $row['heure_fin'] . "</td>
                                        <td>" . $row['activite'] . "</td>
                                        <td>" . $row['coach'] . "</td>
                                      </tr>";

                                // Insérer le rendez-vous
                                $coach_id = $row['coach_id'];
                                $sql_insert = "INSERT INTO rendez_vous (utilisateur_id, date, heure, activite_id, coach_id)
                                               VALUES ('$utilisateur_id', '$date', '$heure', '$activite_id', '$coach_id')";

                                if (mysqli_query($db_handle, $sql_insert)) {
                                    echo "Nouveau rendez-vous créé avec succès avec le coach " . $row['coach'] . "<br>";
                                } else {
                                    echo "Erreur: " . mysqli_error($db_handle) . "<br>";
                                }
                            }
                            echo "</table>";
                        } else {
                            echo "Aucune disponibilité trouvée.";
                        }
                        break;
                }
            }

            // Fermer la connexion
            mysqli_close($db_handle);
            ?>
        </section>
    </main>
    
    <footer>
        <p>Contactez-nous par mail, téléphone ou à notre adresse physique.</p>
    </footer>
</body>
</html>
